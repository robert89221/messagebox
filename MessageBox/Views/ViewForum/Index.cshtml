@model MessageBox.Models.TopicModel
@using Microsoft.AspNetCore.Identity;
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager

@{
  ViewData["Title"] = Model.TopicName;
}

<h1>@ViewData["Title"]</h1>

@{
  var IsSignedIn = SignInManager.IsSignedIn(User);
  var IsAdmin = IsSignedIn && User.Identity.Name.Contains("admin");
  var ctx = ViewBag.Context as ApplicationDbContext;
}

@if (IsSignedIn)
{
  <p>
    <a asp-action="Create">Create new post</a>
  </p>
}

<table class="table">
  <thead>
    <tr>
      <th></th>
    </tr>
  </thead>
  <tbody>
    @foreach (var item in Model.Messages.OrderByDescending(m => m.Date))
    {
      <tr>
        <td>
          <p>
            <b>@item.Title</b>, posted at @item.Date by @item.Poster.UserName
          </p>
          <p>
            @item.Text
          </p>
          @if (IsAdmin)
          {
            <form asp-controller="ViewForum" method="post" asp-action="Delete" >
              <input type="hidden" id="Id" name="Id" value="@item.Id" />
              <input type="submit" value="Delete" class="btn btn-danger" />
            </form>
          }
          @*
        <td>
          <a asp-action="Edit" asp-route-id="@item.Id">Edit</a> |
          <a asp-action="Details" asp-route-id="@item.Id">Details</a> |
          <a asp-action="Delete" asp-route-id="@item.Id">Delete</a>
        </td>
        *@
      </tr>
    }
  </tbody>
</table>
